<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:p="http://primefaces.org/ui">

<ui:composition template="layout.xhtml">
    <ui:define name="content">
        <h1 align="center">#{msg.tao_moi_order}</h1>
        <p:spacer height="10px"/>

        <!--@elvariable id="msg" type="vn.ontaxi.messages.ResourceBundleBean"-->
        <h:outputScript name="js/new_order.js"/>
        <h:form id="newOrderForm">
            <!--@elvariable id="newOrderComponent" type="vn.ontaxi.hub.component.NewOrderComponent"-->
            <!--@elvariable id="selectItemGenerator" type="vn.ontaxi.hub.component.SelectItemGenerator"-->
            <p:growl id="growl" showDetail="true" sticky="true" severity="error, info"/>
            <table class="table_booking_info">
                <tr>
                    <td class="label">
                        Mobile
                    </td>
                    <td>
                        <p:inputText id="mobile" label="#{msg.mobile}" type="text" autocomplete="false"
                                     value="#{newOrderComponent.booking.mobile}" required="true"/>
                        <p:message for="mobile"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        #{msg.customer_name}
                    </td>
                    <td>
                        <p:inputText id="name" label="#{msg.name}" type="text" value="#{newOrderComponent.booking.name}"
                                     required="false" autocomplete="false"/>
                        <p:message for="name"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        #{msg.returned_customer}
                    </td>
                    <td>
                        <p:selectBooleanCheckbox id="returnCustomer" value="#{newOrderComponent.booking.returnedCustomer}" onchange="function updatePromotionPercentage() {
                            if(document.getElementById('newOrderForm:returnCustomer_input').checked) {
                                PF('promotionPercentageSelect').selectValue('4.0');
                            } else {
                                PF('promotionPercentageSelect').selectValue('0.0');
                            }
                        }
                        updatePromotionPercentage();"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        #{msg.loai_xe}
                    </td>
                    <td>
                        <p:selectOneMenu value="#{newOrderComponent.booking.car_type}">
                            <f:selectItem itemLabel="4 Cho" itemValue="N4"/>
                            <f:selectItem itemLabel="4 Cho Vios" itemValue="G4"/>
                            <f:selectItem itemLabel="7 Cho" itemValue="N7"/>
                        </p:selectOneMenu>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        #{msg.diem_di}
                    </td>
                    <td colspan="3">
                        <p:inputText id="fromLocation" value="#{newOrderComponent.booking.from_location}"
                                     required="true" style="width: 600px" autocomplete="false"/>
                        <p:message for="fromLocation"/>
                        <p:inputText type="hidden" id="fromCity" class="administrative_area_level_1"
                                     value="#{newOrderComponent.booking.from_city}"/>
                        <p:inputText type="hidden" id="fromDistrict" class="administrative_area_level_2"
                                     value="#{newOrderComponent.booking.from_district}"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        #{msg.diem_den}
                    </td>
                    <td colspan="3">
                        <p:inputText id="toLocation" value="#{newOrderComponent.booking.to_location}" required="true"
                                     style="width: 600px" autocomplete="false"/>
                        <p:message for="toLocation"/>
                        <p:inputText type="hidden" id="toCity" class="administrative_area_level_1"
                                     value="#{newOrderComponent.booking.to_city}"/>
                        <p:inputText type="hidden" id="toDistrict" class="administrative_area_level_2"
                                     value="#{newOrderComponent.booking.to_district}"/>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        #{msg.hai_chieu}
                    </td>
                    <td>
                        <p:selectBooleanCheckbox value="#{newOrderComponent.booking.roundTrip}">
                            <p:ajax update="waitingHourText"/>
                        </p:selectBooleanCheckbox>
                    </td>
                    <td class="label">
                        #{msg.gio_cho}
                    </td>
                    <td>
                        <p:inputText id="waitingHourText" type="text" value="#{newOrderComponent.booking.wait_hours}"
                                     style="width: 60px" disabled="#{not newOrderComponent.booking.roundTrip}"/>
                    </td>
                </tr>
            </table>
            <table class="table_booking_info">
                <tr>
                    <td class="label">
                        #{msg.khoi_hanh}
                    </td>
                    <td>
                        <p:calendar id="departureDate" value="#{newOrderComponent.booking.departure_time}" autocomplete="false"
                                    pattern="MM/dd/yyyy HH:mm" required="true"/>
                        <p:message for="departureDate"/>
                    </td>
                </tr>
            </table>
            <table class="table_booking_info">
                <tr>
                    <td class="label">
                        Khách Hợp Đồng
                    </td>
                    <td>
                        <div><p:selectBooleanCheckbox value="#{newOrderComponent.booking.laterPaid}"
                                                      style="vertical-align: super; padding-right: 10px">
                            <p:ajax update="debitorOption"/>
                        </p:selectBooleanCheckbox>
                            <p:selectOneMenu id="debitorOption" value="#{newOrderComponent.booking.debtor}" disabled="#{!newOrderComponent.booking.laterPaid}">
                                <f:selectItems value="#{selectItemGenerator.debtorSelectItems}"/>
                            </p:selectOneMenu></div>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        Trọn Gói
                    </td>
                    <td>
                        <div>
                            <p:selectBooleanCheckbox value="#{newOrderComponent.booking.fixedPrice}"
                                                     style="vertical-align: middle; padding-right: 10px">
                                <p:ajax update="fixedPriceText, transportFeeText"/>
                            </p:selectBooleanCheckbox>
                            <p:inputText id="fixedPriceText" type="text" value="#{newOrderComponent.booking.total_price}"
                                         style="width: 60px" disabled="#{not newOrderComponent.booking.fixedPrice}">
                                <f:convertNumber pattern="#,###"/>
                                <p:ajax event="blur" update="fixedPriceText"/>
                            </p:inputText>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        Phí Cầu Đường
                    </td>
                    <td>
                        <div>
                            <p:inputText id="transportFeeText" type="text" value="#{newOrderComponent.booking.transport_fee}"
                                         style="width: 60px" disabled="#{not newOrderComponent.booking.fixedPrice}">
                                <f:convertNumber pattern="#,###"/>
                                <p:ajax event="blur" update="transportFeeText"/>
                            </p:inputText>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        #{msg.promotion}
                    </td>
                    <td>
                        <p:selectOneMenu id="promotionPercentage" value="#{newOrderComponent.booking.promotionPercentage}" widgetVar="promotionPercentageSelect">
                            <f:selectItems value="#{newOrderComponent.promotionPercentageSelectItems}"/>
                            <p:ajax update="promotionPercentage"/>
                        </p:selectOneMenu>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        Phần Trăm Thu
                    </td>
                    <td>
                        <p:selectOneMenu id="feePercentage" value="#{newOrderComponent.booking.fee_percentage}">
                            <f:selectItems value="#{newOrderComponent.feePercentageSelectItems}"/>
                            <p:ajax update="feePercentage"/>
                        </p:selectOneMenu>
                    </td>
                </tr>
                <tr>
                    <td class="label">
                        #{msg.driver_group_option}
                    </td>
                    <td>
                        <p:selectOneRadio value="#{newOrderComponent.sendToGroupOption}">
                            <f:selectItems value="#{newOrderComponent.sendToDriverGroupsOptions}"/>
                            <p:ajax update="chooseDriverMenu"/>
                        </p:selectOneRadio>
                    </td>
                </tr>
                <tr>
                    <td/>
                    <td>
                        <!--@elvariable id="driverConverter" type="vn.ontaxi.hub.converter.DriverConverter"-->
                        <p:selectManyMenu id="chooseDriverMenu" style="width: 500px" disabled="#{!newOrderComponent.sendToIndividual}"
                                          value="#{newOrderComponent.selectedDrivers}"
                                          converter="#{driverConverter}" validator="#{newOrderComponent.validateSelectDriver}"
                                          var="d" filter="true" filterMatchMode="contains" showCheckbox="true">
                            <f:selectItems value="#{newOrderComponent.drivers}" var="driver" itemValue="#{driver}"
                                           itemLabel="#{driver.name}"/>
                            <p:column>
                                <h:outputText value="#{d.name}"/>
                            </p:column>
                            <p:column>
                                <h:outputText value="#{d.mobile}"/>
                            </p:column>
                            <p:column>
                                <h:outputText value="#{d.carType}"/>
                            </p:column>
                            <p:ajax/>
                        </p:selectManyMenu>
                        <h:message for="chooseDriverMenu"/>
                    </td>
                </tr>
            </table>
            <table>
                <tr>
                    <td>
                        <p:commandButton value="#{msg.schedule}" action="#{newOrderComponent.scheduleBooking}" update="newOrderForm"/>
                    </td>
                    <td>
                        <p:commandButton value="#{msg.send_to_driver}" action="#{newOrderComponent.postBooking}" update="newOrderForm"/>
                    </td>
                    <td>
                        <p:commandButton value="#{msg.danh_sach}" action="index.jsf?faces-redirect=true" ajax="false" immediate="true"/>
                    </td>
                </tr>
            </table>
        </h:form>
        <!-- admin@ontaxi.vn key -->
        <script type="text/javascript"
                src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBW25lEAB7icCTEGm_WKVELX27nXn7e0Z4&amp;libraries=places&amp;callback=initMap"/>
        <style type="text/css">
            /* Always set the map height explicitly to define the size of the div
             * element that contains the map. */
            #map {
                height: 100%;
            }

            /* Optional: Makes the sample page fill the window. */
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }

            .table_booking_info {
                border: 1px solid black;
                margin-top: 10px;
                width: 100%;
            }

            .label {
                width: 15%;
            }

        </style>
    </ui:define>

</ui:composition>
</html>